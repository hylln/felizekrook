---
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";

import img1 from "../assets/1.jpeg";
import img2 from "../assets/2.jpeg";
import img3 from "../assets/3.jpeg";
import img4 from "../assets/4.jpeg";
import img5 from "../assets/5.jpeg";
import img6 from "../assets/6.jpeg";
---

<Layout title="HOME">
	<svg
		style="position: absolute; width: 0; height: 0;"
		aria-hidden="true"
		focusable="false"
	>
		<filter id="cyber-glitch">
			<feTurbulence
				type="fractalNoise"
				baseFrequency="0.01 0.2"
				numOctaves="3"
				result="noise"></feTurbulence>
			<feDisplacementMap in="SourceGraphic" in2="noise" scale="10"
			></feDisplacementMap>
		</filter>
	</svg>

	<header class="hero">
		<a href="/" class="logo-link">
			<h1>FELIZE KROOK</h1>
		</a>
		<nav class="header-nav">
			<a href="/gallery">GALLERY</a>
			<a href="/about">ABOUT</a>
			<a href="/contact">CONTACT</a>
		</nav>
	</header>

	<main class="main-content" id="scroll-container">
		<section class="centered-gallery">
			<div class="project-card landing-card" id="landing-trigger">
				<div class="video-background" id="video-wrapper">
					<div id="playback-status" class="playback-status">
						<svg
							class="pause-icon"
							width="10"
							height="10"
							viewBox="0 0 10 10"
						>
							<rect
								x="1"
								y="0"
								width="1.5"
								height="10"
								fill="white"></rect>
							<rect
								x="7.5"
								y="0"
								width="1.5"
								height="10"
								fill="white"></rect>
						</svg>
						<svg
							class="play-icon"
							width="10"
							height="10"
							viewBox="0 0 10 10"
						>
							<polygon points="0,0 10,5 0,10" fill="white"
							></polygon>
						</svg>
					</div>

					<video
						autoplay
						muted
						playsinline
						id="bg-video-1"
						class="bg-video is-active"
					>
						<source src="/clouds.mp4" type="video/mp4" />
					</video>
					<video muted playsinline id="bg-video-2" class="bg-video">
						<source src="/mountains.mp4" type="video/mp4" />
					</video>
					<video muted playsinline id="bg-video-3" class="bg-video">
						<source src="/waves.mp4" type="video/mp4" />
					</video>

					<div class="video-overlay" id="glitch-overlay"></div>
					<div class="scroll-fade-overlay" id="scroll-fade"></div>
				</div>

				<div class="landing-content" id="landing-text-wrapper">
					<p class="landing-label">
						PORTFOLIO<br />SHOWCASE<br />2026
					</p>
					<div class="scroll-to-continue scroll-trigger">
						SCROLL TO CONTINUE
					</div>
					<div class="landing-arrow-container">
						<div class="arrow-indicator down-arrow scroll-trigger">
							<svg
								viewBox="0 0 20 100"
								preserveAspectRatio="none"
							>
								<line
									x1="10"
									y1="0"
									x2="10"
									y2="100"
									stroke="white"
									stroke-width="0.8"></line>
								<polyline
									points="4,96 10,100 16,96"
									fill="none"
									stroke="white"
									stroke-width="0.8"></polyline>
							</svg>
						</div>
					</div>
				</div>
			</div>

			<div class="project-card first-hero">
				<div class="image-container">
					<Image
						src={img2}
						alt="Project 01"
						class="zoom-img"
						quality="high"
						format="webp"
					/>
					<div class="details"><span>01</span> SKETCHES</div>
				</div>
			</div>
			<div class="project-card first-hero">
				<div class="image-container">
					<Image
						src={img1}
						alt="Project 02"
						class="zoom-img"
						quality="high"
						format="webp"
					/>
					<div class="details"><span>02</span> PANTHER</div>
				</div>
			</div>
			<div class="project-card first-hero">
				<div class="image-container">
					<Image
						src={img4}
						alt="Project 03"
						class="zoom-img"
						quality="high"
						format="webp"
					/>
					<div class="details"><span>03</span> SKETCHES 2</div>
				</div>
			</div>
			<div class="project-card first-hero">
				<div class="image-container">
					<Image
						src={img5}
						alt="Project 04"
						class="zoom-img"
						quality="high"
						format="webp"
					/>
					<div class="details"><span>04</span> FELIZE</div>
				</div>
			</div>
			<div class="project-card first-hero">
				<div class="image-container">
					<Image
						src={img6}
						alt="Project 05"
						class="zoom-img"
						quality="high"
						format="webp"
					/>
					<div class="details"><span>05</span> BALENCIAGA</div>
				</div>
			</div>
			<div class="project-card first-hero">
				<div class="image-container">
					<Image
						src={img3}
						alt="Project 06"
						class="zoom-img"
						quality="high"
						format="webp"
					/>
					<div class="details"><span>06</span> CHANEL</div>
				</div>
			</div>

			<div class="project-card footer-card">
				<div class="footer-content">
					<p class="footer-label">INQUIRIES</p>
					<a
						href="mailto:FELIZE.KROOK1@GMAIL.COM"
						class="footer-email">FELIZE.KROOK1@GMAIL.COM</a
					>
					<div class="footer-links">
						<a
							href="https://instagram.com/felizekrook"
							target="_blank">INSTAGRAM</a
						>
						<a href="/about">ABOUT</a>
					</div>
					<button id="back-to-top" class="back-to-top-text"
						>BACK TO TOP</button
					>
				</div>
			</div>
		</section>
	</main>

	<div id="lightbox" class="lightbox">
		<span class="close-lightbox" id="close-btn">&times;</span>
		<div class="lightbox-content-wrapper" id="lightbox-wrapper">
			<img
				class="lightbox-content"
				id="lightbox-img"
				alt="Fullscreen View"
			/>
		</div>
	</div>

	<style>
		:global(body) {
			margin: 0;
			overflow: hidden;
			background-color: #fff;
			font-family: sans-serif;
			-webkit-text-size-adjust: 100%;
		}
		.main-content {
			width: 100%;
			height: 100vh;
			overflow-y: scroll;
			scroll-snap-type: y mandatory;
			scroll-behavior: smooth;
		}
		.hero {
			text-align: center;
			position: fixed;
			width: 100%;
			top: 0;
			z-index: 1000;
			background-color: #ffffff;
			padding: 2rem 2rem;
			border-bottom: 1px solid rgba(0, 0, 0, 0.2);
			display: flex;
			justify-content: center;
			align-items: center;
			box-sizing: border-box;
		}
		h1 {
			font-size: clamp(1rem, 2vw, 12rem);
			line-height: 0.85;
			letter-spacing: -0.05em;
			text-transform: uppercase;
			margin: 0;
			color: #000;
		}
		.logo-link {
			text-decoration: none;
			color: inherit;
			display: inline-block;
			transition: opacity 0.3s ease;
		}
		.logo-link:hover {
			opacity: 0.6;
		}
		.header-nav {
			position: absolute;
			right: 2rem;
			display: flex;
			gap: 1.5rem;
		}
		.header-nav a {
			font-size: 0.7rem;
			text-decoration: none;
			color: #000;
			letter-spacing: 0.05em;
			text-transform: uppercase;
			transition: opacity 0.3s ease;
		}
		.header-nav a:hover {
			opacity: 0.6;
		}

		.landing-card {
			position: relative;
			overflow: hidden;
			background-color: #000;
		}
		.video-background {
			opacity: 0;
			transition: opacity 1.5s ease-in-out;
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 1;
			pointer-events: none;
		}
		.landing-content {
			opacity: 0;
			z-index: 10;
			text-align: center;
			color: #fff;
			pointer-events: none;
			width: 100%;
			transition:
				opacity 0.8s ease-in-out,
				color 0.1s steps(2);
		}
		.scroll-trigger {
			cursor: pointer;
			pointer-events: auto;
			transition: opacity 0.3s ease;
		}
		.scroll-trigger:hover {
			opacity: 0.6;
		}
		.is-visible {
			opacity: 1 !important;
		}
		.bg-video {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			object-fit: cover;
			opacity: 0;
		}
		.bg-video.is-active {
			opacity: 1;
			z-index: 2;
		}

		.video-glitch {
			filter: url(#cyber-glitch) contrast(1.2) brightness(1.1);
			animation: glitch-switch 0.1s steps(2) infinite;
		}
		@keyframes glitch-switch {
			0% {
				transform: scale(1) skew(0deg);
				filter: hue-rotate(0deg) contrast(1.2);
			}
			50% {
				transform: scale(1.02) skew(2deg) translateX(5px);
				filter: hue-rotate(180deg) brightness(1.5);
			}
			100% {
				transform: scale(0.98) skew(-2deg) translateX(-5px);
				filter: hue-rotate(0deg) contrast(1.2);
			}
		}
		.text-glitch {
			filter: url(#cyber-glitch);
			transform: translateX(2px);
		}

		.video-overlay {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: linear-gradient(
				rgba(18, 16, 16, 0) 50%,
				rgba(0, 0, 0, 0.1) 50%
			);
			background-size: 100% 2px;
			z-index: 5;
			pointer-events: none;
		}
		.scroll-fade-overlay {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: #000;
			opacity: 0;
			z-index: 6;
			pointer-events: none;
		}
		.playback-status {
			position: absolute;
			top: 130px;
			left: 2rem;
			z-index: 100;
			opacity: 1;
			cursor: pointer;
			transition:
				opacity 0.3s ease,
				color 0.1s steps(2);
			display: flex;
			align-items: center;
			pointer-events: auto;
			padding: 10px;
		}
		.playback-status:hover {
			opacity: 0.6;
		}
		.playback-status.is-paused .pause-icon {
			display: none;
		}
		.playback-status:not(.is-paused) .play-icon {
			display: none;
		}
		.playback-status.is-paused .play-icon {
			display: block;
		}
		.landing-content.is-dark {
			color: #000;
		}
		.landing-content.is-dark .arrow-indicator svg line,
		.landing-content.is-dark .arrow-indicator svg polyline {
			stroke: #000;
		}
		.playback-status.is-dark svg rect,
		.playback-status.is-dark svg polygon {
			fill: #000;
			transition: fill 0.1s steps(2);
		}

		.landing-arrow-container {
			margin-top: 2rem;
			height: 15vh;
			display: flex;
			justify-content: center;
		}
		.arrow-indicator {
			position: relative;
			height: 100%;
			width: 20px;
		}

		.project-card {
			width: 100%;
			height: 100vh;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			scroll-snap-align: center;
			padding: 0 2rem;
			box-sizing: border-box;
			position: relative;
			scroll-margin-top: 100px;
		}
		.image-container {
			position: relative;
			width: fit-content;
			max-width: 600px;
		}
		.zoom-img {
			width: auto;
			max-width: 100%;
			height: auto;
			max-height: 65vh;
			object-fit: contain;
			cursor: zoom-in;
			transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
		}
		.zoom-img:hover {
			transform: scale(1.05);
		}
		.details {
			display: flex;
			justify-content: space-between;
			margin-top: 1.5rem;
			font-size: 0.7rem;
			text-transform: uppercase;
			letter-spacing: 0.1em;
			width: 100%;
		}
		.footer-content {
			text-align: center;
			width: 100%;
			max-width: 800px;
			display: flex;
			flex-direction: column;
			align-items: center;
		}
		.footer-label {
			font-size: 0.6rem;
			letter-spacing: 0.2em;
			margin-bottom: 1.5rem;
			text-transform: uppercase;
			color: #000;
		}
		.footer-email {
			font-size: clamp(1rem, 2.5vw, 2.2rem);
			text-decoration: none;
			color: #000;
			display: block;
			margin-bottom: 3.5rem;
			transition: opacity 0.6s ease;
		}
		.footer-email:hover {
			opacity: 0.6;
		}
		.footer-links {
			display: flex;
			justify-content: center;
			gap: 2.5rem;
			margin-bottom: 4rem;
		}
		.footer-links a {
			font-size: 0.7rem;
			text-decoration: none;
			color: #000;
			letter-spacing: 0.1em;
			transition: opacity 0.2s ease;
		}
		.back-to-top-text {
			background: none;
			border: none;
			padding: 0;
			cursor: pointer;
			font-size: 0.7rem;
			letter-spacing: 0.1em;
			text-transform: uppercase;
			color: #000 !important;
			transition: opacity 0.2s ease;
		}

		/* --- LIGHTBOX TRANSITION FIXES --- */
		.lightbox {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 3000;
			display: flex;
			justify-content: center;
			align-items: center;
			background-color: rgba(255, 255, 255, 0.6);
			backdrop-filter: blur(2px);
			opacity: 0;
			visibility: hidden; /* This now transitions! */
			pointer-events: none;
			transition:
				opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1),
				visibility 0.6s cubic-bezier(0.4, 0, 0.2, 1);
			touch-action: none;
		}
		.lightbox.show {
			opacity: 1;
			visibility: visible;
			pointer-events: auto;
		}
		.close-lightbox {
			position: absolute;
			top: 2rem;
			right: 2rem;
			font-size: 2.5rem;
			z-index: 4000;
			cursor: pointer;
			color: #000;
			line-height: 1;
		}
		.lightbox-content-wrapper {
			width: 100%;
			height: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		.lightbox-content {
			max-width: 90%;
			max-height: 85vh;
			object-fit: contain;
			user-select: none;
			pointer-events: auto;
			transform-origin: center center;
			/* Added scale transition for close effect */
			transform: scale(0.9);
			transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
		}
		.lightbox.show .lightbox-content {
			transform: scale(1);
		}

		@media (max-width: 900px) {
			h1 {
				font-size: 1.4rem;
			}
			.hero {
				padding: 1.5rem 1rem;
				flex-direction: column;
				gap: 1rem;
			}
			.header-nav {
				position: static;
				justify-content: center;
				gap: 2rem;
				width: 100%;
			}
			.landing-content {
				position: absolute !important;
				top: 55% !important;
				left: 50% !important;
				transform: translate(-50%, -50%) !important;
				width: 100%;
			}
			.zoom-img:hover {
				transform: scale(1);
			}
			.playback-status {
				top: 160px;
				left: 1.5rem;
			}
		}
	</style>

	<script>
		const v1 = document.getElementById("bg-video-1") as HTMLVideoElement;
		const v2 = document.getElementById("bg-video-2") as HTMLVideoElement;
		const v3 = document.getElementById("bg-video-3") as HTMLVideoElement;
		const videos = [v1, v2, v3];

		const landingCard = document.getElementById("landing-trigger");
		const scrollFade = document.getElementById("scroll-fade");
		const mainContent = document.getElementById(
			"scroll-container",
		) as HTMLElement;
		const landingText = document.getElementById("landing-text-wrapper");
		const videoWrapper = document.getElementById("video-wrapper");
		const playbackStatus = document.getElementById("playback-status");
		const lightbox = document.getElementById("lightbox") as HTMLElement;
		const lightboxImg = document.getElementById(
			"lightbox-img",
		) as HTMLImageElement;
		const closeBtn = document.getElementById("close-btn");

		let currentIndex = 0;
		let isTransitioning = false;

		// Interaction Variables
		let initialPinchDistance = 0;
		let isPinching = false;
		let lastTapTime = 0;
		let isDoubleTapZoomed = false;

		function getDistance(touches: TouchList) {
			const dx = touches[0].clientX - touches[1].clientX;
			const dy = touches[0].clientY - touches[1].clientY;
			return Math.sqrt(dx * dx + dy * dy);
		}

		function getPinchCenter(touches: TouchList, element: HTMLElement) {
			const rect = element.getBoundingClientRect();
			const centerX = (touches[0].clientX + touches[1].clientX) / 2;
			const centerY = (touches[0].clientY + touches[1].clientY) / 2;
			return `${((centerX - rect.left) / rect.width) * 100}% ${((centerY - rect.top) / rect.height) * 100}%`;
		}

		function getSingleTapCenter(touch: Touch, element: HTMLElement) {
			const rect = element.getBoundingClientRect();
			return `${((touch.clientX - rect.left) / rect.width) * 100}% ${((touch.clientY - rect.top) / rect.height) * 100}%`;
		}

		const updateUI = () => {
			const currentVideo = videos[currentIndex];
			if (playbackStatus) {
				currentVideo.paused
					? playbackStatus.classList.add("is-paused")
					: playbackStatus.classList.remove("is-paused");
			}
			if (currentIndex === 1) {
				landingText?.classList.add("is-dark");
				playbackStatus?.classList.add("is-dark");
			} else {
				landingText?.classList.remove("is-dark");
				playbackStatus?.classList.remove("is-dark");
			}
		};

		function showLanding() {
			videoWrapper?.classList.add("is-visible");
			v1.play()
				.then(() => {
					landingText?.classList.add("is-visible");
					updateUI();
				})
				.catch(() => {
					landingText?.classList.add("is-visible");
					updateUI();
				});
		}

		if (v1) {
			v1.addEventListener("playing", showLanding, { once: true });
			if (v1.readyState >= 3) showLanding();
		}

		function triggerCyberSwap() {
			if (isTransitioning) return;
			isTransitioning = true;
			const oldVideo = videos[currentIndex];
			oldVideo.classList.add("video-glitch");
			landingText?.classList.add("text-glitch");

			setTimeout(() => {
				oldVideo.classList.remove("is-active");
				oldVideo.pause();
				currentIndex = (currentIndex + 1) % videos.length;
				const newVideo = videos[currentIndex];
				newVideo.classList.add("is-active");
				newVideo.currentTime = 0;
				newVideo.play().catch(() => {});
				updateUI();
				newVideo.classList.add("video-glitch");
			}, 80);

			setTimeout(() => {
				videos.forEach((v) => v.classList.remove("video-glitch"));
				landingText?.classList.remove("text-glitch");
				isTransitioning = false;
			}, 250);
		}

		function randomGlitch() {
			if (isTransitioning) return;
			const activeVideo = videos[currentIndex];
			if (activeVideo.paused) return;
			if (Math.random() > 0.92) {
				activeVideo.classList.add("video-glitch");
				landingText?.classList.add("text-glitch");
				setTimeout(
					() => {
						activeVideo.classList.remove("video-glitch");
						landingText?.classList.remove("text-glitch");
					},
					50 + Math.random() * 150,
				);
			}
			setTimeout(randomGlitch, 500);
		}

		videos.forEach((v) => {
			v.addEventListener("play", () => {
				updateUI();
				randomGlitch();
			});
			v.addEventListener("pause", updateUI);
			v.addEventListener("timeupdate", () => {
				if (
					v.classList.contains("is-active") &&
					v.currentTime > v.duration - 0.3 &&
					!isTransitioning
				) {
					triggerCyberSwap();
				}
			});
		});

		document.querySelectorAll(".scroll-trigger").forEach((trigger) => {
			trigger.addEventListener("click", (e) => {
				e.stopPropagation();
				document
					.querySelector(".first-hero")
					?.scrollIntoView({ behavior: "smooth", block: "start" });
			});
		});

		const triggerBackToTop = () => {
			if (!mainContent) return;
			mainContent.style.scrollSnapType = "none";
			mainContent.scrollTo({ top: 0, behavior: "smooth" });
			setTimeout(() => {
				mainContent.style.scrollSnapType = "y mandatory";
			}, 800);
		};

		const closeLightbox = () => {
			lightbox.classList.remove("show");
			document.body.style.overflow = "auto";
		};

		// Lightbox Listeners
		if (lightbox && lightboxImg) {
			document.querySelectorAll(".zoom-img").forEach((img) => {
				img.addEventListener("click", () => {
					lightboxImg.src = (img as HTMLImageElement).src;
					isDoubleTapZoomed = false;
					lightbox.classList.add("show");
					document.body.style.overflow = "hidden";
				});
			});

			closeBtn?.addEventListener("click", (e) => {
				e.stopPropagation();
				closeLightbox();
			});

			lightbox.addEventListener(
				"touchstart",
				(e) => {
					if (e.touches.length === 1) {
						const now = Date.now();
						const timesince = now - lastTapTime;
						if (timesince < 300 && timesince > 0) {
							e.preventDefault();
							if (!isDoubleTapZoomed) {
								lightboxImg.style.transformOrigin =
									getSingleTapCenter(
										e.touches[0],
										lightboxImg,
									);
								lightboxImg.style.transition =
									"transform 0.3s ease";
								lightboxImg.style.transform = "scale(2.5)";
								isDoubleTapZoomed = true;
							} else {
								lightboxImg.style.transition =
									"transform 0.3s ease";
								lightboxImg.style.transform = "scale(1)";
								isDoubleTapZoomed = false;
							}
							return;
						}
						lastTapTime = now;
					}
					if (e.touches.length === 2) {
						isPinching = true;
						initialPinchDistance = getDistance(e.touches);
						lightboxImg.style.transformOrigin = getPinchCenter(
							e.touches,
							lightboxImg,
						);
					}
				},
				{ passive: false },
			);

			lightbox.addEventListener(
				"touchmove",
				(e) => {
					if (isPinching && e.touches.length === 2) {
						e.preventDefault();
						const scale =
							getDistance(e.touches) / initialPinchDistance;
						lightboxImg.style.transform = `scale(${scale})`;
						lightboxImg.style.transition = "none";
					}
				},
				{ passive: false },
			);

			lightbox.addEventListener("touchend", (e) => {
				if (isPinching && e.touches.length < 2) {
					isPinching = false;
					lightboxImg.style.transition =
						"transform 0.3s ease, transform-origin 0.3s ease";
					lightboxImg.style.transform = "scale(1)";
					isDoubleTapZoomed = false;
					setTimeout(() => {
						lightboxImg.style.transformOrigin = "center center";
					}, 300);
				}
			});

			lightbox.addEventListener("click", (e) => {
				if (
					e.target === lightbox ||
					(e.target as HTMLElement).id === "lightbox-wrapper"
				)
					closeLightbox();
			});
		}

		window.addEventListener("keydown", (e) => {
			if (
				e.key === "Escape" ||
				(e.key.toLowerCase() === "f" &&
					lightbox.classList.contains("show"))
			) {
				if (lightbox.classList.contains("show")) {
					closeLightbox();
					return;
				}
			}

			if (
				e.key.toLowerCase() === "f" &&
				!lightbox.classList.contains("show")
			) {
				const cards = Array.from(
					document.querySelectorAll(".project-card"),
				);
				const activeCard = cards.find((card) => {
					const rect = card.getBoundingClientRect();
					return rect.top >= -50 && rect.top <= 50;
				});
				const targetImg = activeCard?.querySelector(
					".zoom-img",
				) as HTMLImageElement;
				if (targetImg) {
					lightboxImg.src = targetImg.src;
					lightbox.classList.add("show");
					document.body.style.overflow = "hidden";
				}
			}

			if (
				["ArrowUp", "ArrowDown", " "].includes(e.key) &&
				!lightbox.classList.contains("show")
			) {
				e.preventDefault();
				const cards = Array.from(
					document.querySelectorAll(".project-card"),
				);
				let currentIdx = cards.findIndex((card) => {
					const rect = card.getBoundingClientRect();
					return rect.top >= -10 && rect.top <= 10;
				});
				if (currentIdx === -1) {
					currentIdx = cards.findIndex(
						(card) =>
							card.getBoundingClientRect().top >
							-window.innerHeight / 2,
					);
				}

				if (e.key === "ArrowDown" || e.key === " ") {
					if (currentIdx < cards.length - 1) {
						cards[currentIdx + 1].scrollIntoView({
							behavior: "smooth",
							block: "start",
						});
					} else if (e.key === " ") {
						triggerBackToTop();
					}
				} else if (e.key === "ArrowUp" && currentIdx > 0) {
					cards[currentIdx - 1].scrollIntoView({
						behavior: "smooth",
						block: "start",
					});
				}
			}
		});

		if (playbackStatus) {
			playbackStatus.addEventListener("click", (e) => {
				e.stopPropagation();
				const activeVideo = videos[currentIndex];
				activeVideo.paused ? activeVideo.play() : activeVideo.pause();
			});
		}

		if (landingCard) {
			landingCard.addEventListener("click", () => {
				const activeVideo = videos[currentIndex];
				activeVideo.paused ? activeVideo.play() : activeVideo.pause();
			});
		}

		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						videos[currentIndex].play().catch(() => {});
					} else {
						videos[currentIndex].pause();
					}
				});
			},
			{ threshold: 0.1 },
		);

		if (landingCard) observer.observe(landingCard);

		if (mainContent && scrollFade && landingText) {
			mainContent.addEventListener("scroll", () => {
				const scrollPos = mainContent.scrollTop;
				const progress = Math.min(
					scrollPos / (window.innerHeight * 0.8),
					1,
				);
				scrollFade.style.opacity = progress.toString();
				landingText.style.opacity = (1 - progress * 1.5).toString();
				if (playbackStatus)
					playbackStatus.style.opacity = (
						0.5 *
						(1 - progress * 2)
					).toString();
			});
		}

		document
			.getElementById("back-to-top")
			?.addEventListener("click", triggerBackToTop);
	</script>
</Layout>
